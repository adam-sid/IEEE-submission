\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote.
%If that is unneeded, please comment it out. Template version as of 6/27/2024

\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage[hyphens]{url}
\usepackage[hidelinks]{hyperref}
\usepackage{breakurl}
\bibliographystyle{IEEEtran}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

%TC:ignore

\title{Forecasting microclimates with a low-cost LoRa enabled weather station
network\\
\thanks{This project is funded by the UK Research Institute}
}

\author{\IEEEauthorblockN{1\textsuperscript{st} Adam Sidnell}
\IEEEauthorblockA{\textit{Computer Science MSc} \\
\textit{University of Bristol}\\
Bristol, United Kingdom \\
adam.sidnell@gmail.com}
\and
\IEEEauthorblockN{2\textsuperscript{nd} Ruzanna Chitchyan}
\IEEEauthorblockA{\textit{Professor in Computer Science} \\
\textit{University of Bristol}\\
Bristol, United Kingdom \\
r.chitchyan@bristol.ac.uk} }

\maketitle

\begin{abstract}
General weather forecasts are often too broad to accurately capture the small
climatic variation that exists on farms. This can lead to sub-optimal decisions
on tasks such as crop spraying, frost prevention or irrigation. While commercial
weather stations exist, there is often a trade-off between their cost and
transmission range. Additionally, these hardware products do not attempt to use
their data to offer farmers improved forecasting on their fields. This paper
presents the prototype design and evaluation for Agriscanner: An end-to-end,
low-cost IoT weather station network that incorporates machine learning
(LightGBM) to predict future weather within a field. Data is streamed to a web
application for live visualisation. Evaluation shows the hardware system
achieves a 1,200m range between nodes for a total range of 2,400m in non-ideal
conditions. This was achieved at a cost of £520 for the complete system which
includes two sensor nodes, a repeater and a WiFi gateway while outperforming
commercial alternatives in range and cost. The machine learning model showed
mixed results, outperforming general forecasts for certain climate factors
(wind-speed) but highlighting the need for a larger, more diverse training
dataset.
\end{abstract}

\begin{IEEEkeywords}
machine learning, smart farming, forecast, microclimate, IoT, LoRa, LightGBM
\end{IEEEkeywords}

%TC:endignore

\section{Introduction}\label{INTRO} 

Accurate weather data is critical for decision making in agriculture. Farmers
rely on forecasts for various daily farming functions with significant financial
and environmental costs attached. For example, it is required by law that
pesticide spraying must be done in low wind speed to prevent spray drift which
can damage nearby ecosystems \cite{defra2006code}. Similarly, spring frosts pose
a significant risk to crop yields; a single frost night can reduce crop yields
by as much as 24\% \cite{drepper2022springfrost}, highlighting the need for an
accurate prediction allowing farmers to take appropriate counter measures (in
the case of frosts this could be installing high power fans over the field).

However, general weather forecasts, as provided by the MetOffice in the UK, are
based on macro-scale models which are not designed to capture local climate
variations, known as microclimates. Farmers rank the accuracy and reliability of
weather forecasts as one of the largest limiting factors when making decisions
in growing season \cite{hu2006understanding}.

To address this issue, this paper presents a complete end-to-end system called
Agriscanner. While commercial IoT weather stations exist, simply viewing current
and historical data is insufficient for effective planning. The primary
contribution of this work is a deployable system that applies an open-source
machine learning procedure using locally collected sensor data to forecast the
microclimate.

This approach is distinct from related work in three key areas. First, unlike
studies relying on public datasets or existing sensor networks, we designed and
built the entire low-cost hardware network required to collect data from remote
fields. Second, while other systems focus on complex deep learning models, we
demonstrate the application of an efficient, tree-based machine learning model
(LightGBM) as a more accessible alternative. Third, this model is applied in a
challenging open air environment, as opposed to more controlled contexts such as
greenhouses.

\subsection{LoRa}

To ensure the hardware system was appropriate for the off-grid context of most
agricultural applications, the communication technology chosen for the devices
was highly important.

LoRa (Long Range) is a radio modulation technique invented in 2014 that allows
for the transmission of data over very long distances. The technology is notable
for achieving this long-range transmission (over 4000 times greater than WiFi
\cite{spiess2019}) while using remarkably little power. This makes it the
preferred technology for the remote, off-grid application in this project.

The most important principle that separates LoRa from traditional radio
modulation is its ability to demodulate incoming signals more efficiently. This
allows the receiver to distinguish signals that are below the noise floor - that
is, even when background noise is "louder" than the LoRa signal, the data can
still be processed.

This efficiency gives LoRa a far greater effective range despite their low power
output. Relatedly, it also reduces the power budget for both the transmitter
(sending weaker signals) and the receiver (easier demodulation), which is ideal
for battery-powered devices. For a technical understanding of the technical
aspects of LoRa refer to \cite{vangelista2017}.

The main disadvantage of LoRa is a comparatively low data throughput - around 5
kbps in the configuration used here. However, since the data packets in this
project were very small this was not a major issue.

\section{Related Work}\label{REL}

\subsection{LoRa based IoT in agriculture}

IoT devices have seen widespread adoption in agriculture, with digital solutions
offering the potential to improve yields even in remote areas. LoRa is an
especially relevant technology in this context as the range of these devices
enables data to be transmitted over long distances and the low power allows for
the use of gridless power solutions - such as solar-battery as used here. 

There are relatively few papers examining the effectiveness of LoRa in
agriculture but some notable examples include \cite{edgeAiGiaEtAl} where LoRa
was used in an edge computing exercise. In this study the authors used CNN
machine learning to create a compressed image that holds thousands of simulated
climate readings. This image can then be sent over LoRa to a receiver node which
can infer the readings of each node from this single image. While only one
sensor node was created for the exercise they also tested the range of this
device at a distance of 200m. This system would be useful in particularly large
networks of LoRa devices where the low data transfer speed of LoRa would start
to be a limiting factor.

The authors in \cite{smartFarmKodaliEtAl} implement a LoRa based weather station
prototype in India. The authors create a node that measures temperature,
humidity and soil moisture in an experimental setting with no field deployment.
Readings are then sent via LoRa to a receiver and can be read manually from the
device's screen or viewed on an IBM dashboard.  

\subsection{Weather forecasting microclimates with machine learning}

General weather models operate at magnitudes between 1 and 10 km and
microclimate predictions require models that operate at scales of roughly 100m
or less. Using existing general forecast models for micro-scale predictions is
computationally expensive \cite{blunn2024machine}, and these models have lower
accuracy rates than predictions using machine learning due to the inherent
complexity and non-linear nature of microclimates. Therefore a number of studies
have focused on building bespoke models to predict very local forecasts using
machine learning processes.

A 2021 study by Kumar et al \cite{kumar2021} developed an ML framework called
DeepMC as a part of a Microsoft Research initiative. Their model is able to
predict a variety of climatic variables such as soil moisture, wind speed and
temperature using inputs from weather station forecasts and IoT sensors. They
were able to get up to 90\% accuracy with a 12-120 hour forecast range.

Zanchi et al \cite{zanchi2023harnessing} used physical modelling of local
terrain combined with deep learning (DL) to forecast the microclimate in the
foothills of Lombardy. The objective was to predict the local conditions at the
meter-scale as opposed to the 10km+ scale of regional and global weather
forecasts. The initial model combined data about the morphology of the local
terrain and weather forecast data to provide the input data for two feed-forward
neural networks. These neural networks were trained to predict the local weather
variables using data from 25 sensors deployed in the region being studied.  The
study demonstrated that local predictions were more accurate when using forecast
data from local weather stations as opposed to global climate datasets, but
accuracy good in both.

Blunn et al \cite{blunn2024machine} ran a study focussed on predicting
temperatures in urban environments during heatwaves, using data from eight
heatwaves in London, UK. They used data from the UKV - a high-resolution weather
forecasting model - and from citizen weather stations (CWS). The authors used a
similar model training design to that in this study. A number of ML models were
trained on UKV variables (i.e. a general forecast) and CWS variables (local
sensor data) to bias correct the UKV readings and create a forecast prediction
model that could predict the CWS readings accurately (mean average error:
0.12\(^\circ\)C) compared with the general weather readings from UKV (mean
average error: 0.64\(^\circ\)C). The main points of difference to this paper are
the use of only temperature versus a wider range of variables in this study,
along with the use of custom weather stations here compared to public weather
data.

A recent paper from Abdelmadjid et al 2025 \cite{abdelmadjid2025enhancing} used
online datasets from Kaggle (a public repository of various datasets) to develop
an ML tool to predict changes in temperature and humidity within greenhouses in
response to changes to external weather conditions.  They used these data to
test three ML models and three DL models and selected the LightGBM ML model and
the LSTM DL model as the best performing models for prediction. The overall
system design consisted of four LSTM models feeding into the LightGBM model.
This design resulted in 98.45\% accuracy for temperature predictions and 99.61\%
accuracy for humidity predictions. Due to these results LightGBM was also chosen
for this experiment.

\section{Methodology}\label{METH}

\subsection{IoT hardware}

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/network-diagram.png}}
\caption{Network diagram of the system}
\label{fig}
\end{figure}

The design of the hardware consisted of two sensor nodes, a repeater and a
gateway. The purpose for each is outlined below:

\begin{enumerate}
    \item Sensor node: Collects temperature, humidity, wind speed and soil
    moisture data every 6 seconds. These readings are then averaged and sent as
    a single packet each minute to the repeater. Figure \ref{sensor-node}
    \item Repeater: Receives LoRa signals from the sensor nodes and then
    immediately re-transmits these to boost range. 
    \item Gateway: A hub that receives LoRa signals and then transmits weather
    data using WIFI.
\end{enumerate}

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/node.jpg}}
\caption{Sensor node}
\label{sensor-node}
\end{figure}

All components were commercially available, and assembling the final hardware
required only basic tools. Each device used an RP2040 based microcontroller
(iLabs Challenger LoRa) microcontroller, which provided the necessary computing
power and included built-in LoRa capability for wireless communication. The
gateway node was additionally equipped with a Raspberry Pi to enable WIFI
connectivity and remote access via VNC Viewer.

\subsubsection{Weatherproofing}
All sensitive electronics were housed in an IP65-rated waterproof junction box.
Most external components were water resistant by design with the exception of
the soil moisture sensor: In this case the electronics were coated in
non-conductive nail varnish and sealed with heatshrink. All cable entry points
to the main box were sealed with silicone to prevent water ingress.

\subsection{Deployment}

The nodes were completed by mid-august and were installed in a private garden
for a test deployment collecting local readings from two different locations in
the garden. This helped facilitate easy repairs and updates to the devices.

The system ran continuously in this location from the 15th of August, 2025,
which provided the data used for the machine learning model's training and
evaluation later that month.

\subsection{Webapp design}

Weather data was sent from the gateway to a purpose built webapp called
Agriscanner. This webapp allowed for the displaying of current, historic and
future (predicted) weather.

The dashboard (Figure \ref{dashboard}) displayed live weather data from the
nodes with a 1 minute update frequency. Clicking on a particular data point
allows the user to see a graph of past and future weather data in a way that is
familiar to any user of standard forecasting apps (Figure \ref{temperature}).

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/main-page.jpg}}
\caption{Webapp main dashboard}
\label{dashboard}
\end{figure}

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/temperature-node-one.jpg}}
\caption{Webapp temperature page showing current and predicted weather}
\label{temperature}
\end{figure}

\subsection{Training and deployment of Machine learning algorithm}

To forecast microclimate date up to 48 hours in advance, we trained 10 separate
machine learning models using the LightGBM algorithm. One model was created for
each of the five sensor variables (temperature, humidity, wind speed, gust speed
and soil moisture) for each of the two nodes. LightGBM was selected for its high
performance on tabular climate data as the authors in
\cite{abdelmadjid2025enhancing} show. An additional benefit of this set up is
that LightGBM is compatible with the m2cgen library which allows the conversion
of the final models to individual JavaScript files.

The model was trained using both historical sensor readings collected in the
field and general forecast data taken from OpenWeather's API. The final models
were then able to take future general weather forecast data as input and bias
correct with the aim of improving accuracy.

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/machine-learning-diagram2.jpg}}
\caption{Infographic showing training steps for training with LightGBM}
\label{machine-learning}
\end{figure}

The following steps were followed to train each of the ten models, also shown
visually in Figure \ref{machine-learning}

\begin{enumerate}
    \item \textbf{Dataset prepared:} A single cleaned dataset was created by
          matching timestamps between the api weather data and the sensor node
          data. As API readings are taken every 10 minutes and node readings
          every 1 minute, this meant that 9/10 node readings were discarded. The
          final dataset was roughly 1,400 rows. The data used for training
          spanned the period 15 - 27 August.
    \item \textbf{Feature set and target data defined:} The feature set from the
          weather API and targets from the node data were defined, and
          unnecessary columns discarded. The database timestamp field was
          transformed into sine and cosine representations of day and year. This
          is necessary when training on a time-series data set as the algorithm
          must be able to understand the cyclical nature of time. For example,
          using raw timestamps would incorrectly suggest to the algorithm that
          the times of 23:00 on day 1 and 00:00 on day 2 are not closely
          related.
    \item \textbf{Dataset split into training data (80\%) and validation data
          (20\%):} The data are split by time so the training data consists of
          the first 80\% of the rows and the validation data the last 20\%.
          These data are then supplied to the model.
    \item \textbf{Iterative training:} For each iteration, the model looks at
          the inputs (training features) and the correct answers (training
          target) of the training rows, and determines where it is getting
          incorrect outputs. It builds a small decision tree that specifically
          aims to correct those mistakes on the training rows and adds that tree
          into itself so its predictions change a little. It then applies the
          updated model to the validation inputs (validation features) and
          compares those predictions to the validation answers (validation
          target) —to see how well the model would do on new "unseen" data. The
          validation data are never used to build the tree; they are only used
          to check the accuracy of the model. If the validation check shows no
          improvement after a number of iterations, the training stops and the
          model keeps the version that performed best on validation.  The
          process will perform a minimum of 50 iterations. I set the maximum
          number of iterations to 250 to prevent the models getting too large,
          as each iteration increases the model size substantially (The humidity
          model is over 40,000 lines long in JavaScript format for example).
\end{enumerate}

Once the ten models had been trained, they were uploaded to the web server. An
automated function in the webapp provides the models with datapoints from the
OpenWeather forecast data for the next 48 hours, and updates this data every ten
minutes to adjust the predictions as the forecast changes. The outputs from the
models are recorded as hourly predictions for each datapoint in a JSON file,
which is requested by the frontend software and used to display a line graph of
predicted values for the next 48 hours.

\section{Results}\label{RES}

The system was evaluated in two key areas. First, we evaluated the performance
of the machine learning forecasting. Then we evaluated the custom hardware by
qualitatively analysing its benefits compared with commercial alternatives.

\subsection{Machine learning performance}

The accuracy of the machine learning prediction was evaluated over a period of
48 hours from 12am on 2025/08/30 to 12am on 2025/09/01. This was the period
following the training of the model so was not included in the training data.

The performance of the model was compared to two alternatives:
\begin{enumerate}
    \item \textbf{Raw general forecast from OpenWeather:} This was the input to
    the machine learning model and would give an indication of whether the
    accuracy could be improved.
    \item \textbf{Alternative mean average adjustment:} This simple alternative
    model applied a constant mean average adjustment to the above raw forecast.
    This would help identify if a simpler model than the LightGBM process could
    be used instead.
\end{enumerate}

\begin{figure}[htbp]
\centerline{\includegraphics[width=0.5\textwidth]{figures/results.png}}
\caption{Heatmap results showing MAE and RMSE averaged over both nodes}
\label{results}
\end{figure}

Figure \ref{results} shows the machine learning model performance had mixed
results. 

\subsubsection{Wind and gust speed}

One relative success of the model was in the prediction of wind speed. The
general forecast and alternative model were completely unusable in this regard
with MAE of around 200 to 400\%. This overestimate is likely due to the
macro-scale forecast using wind speed data from much higher positions (often
10m) where wind speeds are much higher. Even the adjusted model does not correct
this enough to come close to the true figure with an MAE of 232\%. The machine
learning model 

\subsection{Range and cost}

\section{Conclusion}\label{CONC}

%TC:ignore

\subsection{Example figure and table}\label{FAT}

\begin{table}[htbp]
\caption{Table Type Styles}
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Table}&\multicolumn{3}{|c|}{\textbf{Table Column Head}} \\
\cline{2-4} 
\textbf{Head} & \textbf{\textit{Table column subhead}}&
\textbf{\textit{Subhead}}& \textbf{\textit{Subhead}} \\
\hline
copy& More table copy$^{\mathrm{a}}$& &  \\
\hline
\multicolumn{4}{l}{$^{\mathrm{a}}$Sample of a Table footnote.}
\end{tabular}
\label{tab1}
\end{center}
\end{table}

\bibliography{references}

%TC:endignore
\end{document}
